<table class="content" width="100%" style="padding-left: 1em; padding-right: 1em;" cellpadding="0" cellspacing="0">
  <tr>
    <td colspan="2" class="page_header">
      <div style="float:left;"><%= session[:user].company.name %> <%=_ 'Chat Transcripts' %></div>
      <div style="float:right;padding-top:0.1em;"><%= link_to _('Chat Rooms'), :action => 'list' %></div>
      </td>
    </tr>
    <tr><td colspan="2">&nbsp;</td></tr>
    <tr>
     <td colspan="2">
       <div id="transcript-list">

<% users = []
   channel = nil
   date = nil

   entries = {}

   for t in @transcripts
     next if t.user_id.to_i == 0
     key = "#{t.year}-#{'%02d' % t.month}-#{'%02d' % t.day}-#{t.shout_channel.name}"
     entries[key] ||= {}
     entries[key]['users'] ||= []
     entries[key]['users'] << t.user.name
     entries[key]['channel'] ||= t.shout_channel
     entries[key]['date'] ||= Date.new(t.year.to_i, t.month.to_i, t.day.to_i).to_time
   end

   last_date = nil
   entries.sort.reverse.each do |k,v|
     if last_date.nil? || (last_date.strftime('%y-%m-%d') != v['date'].strftime('%y-%m-%d'))
        last_date = v['date']
%>
     <div class="log_header"><%= last_date.strftime("%A, %d %B %Y") %></div>
<%   end %>
<div class="transcript">
<span class="transcript-channel"><%= link_to v['channel'].name, :action => 'transcript', :id => v['channel'].id, :day => v['date'].strftime('%y-%m-%d') %></span><br/>
<div class="transcript-participants">Participants <span class="transcript-users"><%= v['users'].sort.join(', ') %></span></div>
</div>
<% end %>
       </div>
     </td>
  </tr>
</table>

<br />

