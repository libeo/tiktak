<li class="attribute">
  <% 
     prefix = "custom_attributes"
     prefix = "new_#{ prefix }" if attribute.new_record? 
     preset = attribute.custom_attribute_choices.any?
   -%>

  <% fields_for(prefix, attribute) do |f| %>
    <%= f.hidden_field :position, :index => attribute.id, :class => "position" %>

    <label><%=_ "Name" %></label>
    <%= f.text_field :display_name, :index => attribute.id %>
    <%= sortable_handle_tag(attribute) %>
    <%= link_to_remove_parent %>

    <label><%=_ "Use only preset choices" %></label>
    <%= check_box_tag(:preset, 1, preset, :onChange => "updateAttributeFields(this)") %>

    <label><%=_ "Mandatory" %></label>
    <%= nested_boolean_choice_field(f, :mandatory, attribute) %>

    <label><%=_ "Allows multiple" %></label>
    <%= nested_boolean_choice_field(f, :multiple, attribute) %>

    <span class="max_length" style="display: <%= preset ? "none" : "" %>">
      <label><%=_ "Maximum field length " %></label>
      <%= f.text_field :max_length, :index => attribute.id %>
    </span>

    <span class="choices" style="display: <%= preset ? "" : "none" %>">
      <label title="One per line"><%=_ "Choices" %></label>
      <%= f.text_area :choices_as_text, :index => attribute.id, :rows => 10 %>
    </span>
    
  <% end %>
  <br />
</li>
